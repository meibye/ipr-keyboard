[Unit]
Description=IPR Keyboard BlueZ Pairing Agent (LE HOGP)
After=bluetooth.service
Requires=bluetooth.service
BindsTo=bluetooth.service
PartOf=bluetooth.service

[Service]
Type=simple
StandardOutput=journal
StandardError=journal
SyslogIdentifier=bt_hid_agent_unified

EnvironmentFile=-/opt/ipr_common.env

# Prepare adapter for LE-only HID over GATT.
ExecStartPre=/usr/bin/hciconfig ${BT_HCI:-hci0} up
ExecStartPre=/usr/bin/btmgmt -i ${BT_HCI:-hci0} le on
ExecStartPre=/bin/sh -c '/usr/bin/btmgmt -i "${BT_HCI:-hci0}" bredr off >/dev/null 2>&1 || true'
ExecStartPre=/usr/bin/btmgmt -i ${BT_HCI:-hci0} bondable on
ExecStartPre=/usr/bin/btmgmt -i ${BT_HCI:-hci0} connectable on

ExecStart=/usr/bin/python3 -u /usr/local/bin/bt_hid_agent_unified.py --adapter ${BT_HCI:-hci0}

Restart=always
RestartSec=2

[Install]
WantedBy=multi-user.target
